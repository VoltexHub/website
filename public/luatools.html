<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lua Tools</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
body{background:linear-gradient(135deg,#1a1a2e,#16213e);color:#fff;min-height:100vh;display:flex;justify-content:center;align-items:flex-start;padding:20px;}
.container{width:100%;max-width:1000px;padding:20px;}
h1{text-align:center;margin-bottom:20px;color:#00eeff;text-shadow:0 0 10px rgba(0,238,255,0.5);}
.tabs{display:flex;gap:5px;margin-bottom:20px;flex-wrap:wrap;}
.tab{padding:10px 20px;background:#222244;border-radius:6px;cursor:pointer;transition:0.2s;}
.tab.active{background:#00c6ff;color:#000;font-weight:bold;}
.panel{display:none;flex-direction:column;gap:10px;}
.panel.active{display:flex;}
textarea, input{padding:12px;border-radius:6px;border:2px solid #39396b;background:rgba(30,30,60,0.8);color:#fff;font-size:14px;font-family:monospace;width:100%;min-height:250px;resize:vertical;}
input[type=text]{min-height:40px;}
.btn{padding:10px;border-radius:6px;border:none;background:linear-gradient(135deg,#00c6ff,#0072ff);color:white;font-weight:bold;cursor:pointer;transition:all 0.3s;}
.btn:hover{background:linear-gradient(135deg,#00eeff,#008cff);transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,238,255,0.4);}
.feedback{font-size:14px;}
.feedback.success{color:#55ff55;}
.feedback.error{color:#ff5555;}
.button-group{display:flex;gap:10px;flex-wrap:wrap;}
.script-result{display:flex;gap:10px;padding:10px;border:1px solid #39396b;border-radius:6px;background:rgba(20,20,40,0.8);}
.script-result img{width:80px;height:80px;border-radius:6px;object-fit:cover;}
.script-text{display:flex;flex-direction:column;gap:4px;}
</style>
</head>
<body>
<div class="container">
<h1>Lua Tools</h1>

<div class="tabs">
  <div class="tab active" data-tab="obf">Obfuscator / Deobfuscator</div>
  <div class="tab" data-tab="fmt">Formatter / Code Run</div>
  <div class="tab" data-tab="search">Script Search</div>
</div>

<div class="panel active" id="obf">
  <textarea id="obfCode" placeholder="Paste Lua code..."></textarea>
  <div class="button-group">
    <button class="btn" id="obfBtn">Obfuscate</button>
    <button class="btn" id="obfUndo">Undo</button>
  </div>
  <div id="obfFeedback" class="feedback"></div>
</div>

<div class="panel" id="fmt">
  <textarea id="fmtCode" placeholder="Paste Lua code..."></textarea>
  <div class="button-group">
    <button class="btn" id="fmtBtn">Format / Minify</button>
    <button class="btn" id="runBtn">Run Code</button>
  </div>
  <textarea id="runOutput" placeholder="Output / Log..." readonly style="min-height:200px;"></textarea>
  <div id="fmtFeedback" class="feedback"></div>
</div>

<div class="panel" id="search">
  <div class="button-group">
    <input type="text" id="searchQuery" placeholder="Search ScriptBlox...">
    <button class="btn" id="searchBtn">Search</button>
  </div>
  <div id="searchResults" style="display:flex;flex-direction:column;gap:10px;margin-top:10px;"></div>
</div>

<script>

const tabs = document.querySelectorAll('.tab');
const panels = document.querySelectorAll('.panel');
tabs.forEach(tab=>{
  tab.addEventListener('click',()=>{
    tabs.forEach(t=>t.classList.remove('active'));
    panels.forEach(p=>p.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(tab.dataset.tab).classList.add('active');
  });
});

let obfOriginal="";
function randomVar(){ return "_v"+Math.floor(Math.random()*10000); }
function obfuscateLua(code){
  code = code.replace(/--\[==*\[.*?\]==*\]/gs,"").replace(/--.*$/gm,"").replace(/\s+/g," ").trim();
  const map={};
  code = code.replace(/\b(local\s+)?([a-zA-Z_][a-zA-Z0-9_]*)\b/g,(m,loc,name)=>{
    if(["function","end","if","then","else","for","in","do","while","repeat","until","return","break","true","false","nil","getgenv","game","workspace"].includes(name)) return m;
    if(!map[name]) map[name]=randomVar();
    return (loc||"")+map[name];
  });
  for(let i=0;i<3;i++){ code += ` function ${randomVar()}() return ${Math.floor(Math.random()*100)} end`; }
  return code;
}
document.getElementById('obfBtn').addEventListener('click',()=>{
  const code=document.getElementById('obfCode').value.trim();
  if(!code) return;
  obfOriginal=code;
  document.getElementById('obfCode').value=obfuscateLua(code);
});
document.getElementById('obfUndo').addEventListener('click',()=>{ if(obfOriginal) document.getElementById('obfCode').value=obfOriginal; });

function minifyLua(code){ return code.replace(/--\[==*\[.*?\]==*\]/gs,"").replace(/--.*$/gm,"").replace(/\s+/g," ").trim(); }
document.getElementById('fmtBtn').addEventListener('click',()=>{
  const code=document.getElementById('fmtCode').value.trim();
  if(!code) return;
  document.getElementById('fmtCode').value=minifyLua(code);
});
document.getElementById('runBtn').addEventListener('click',()=>{
  const code=document.getElementById('fmtCode').value;
  const output = document.getElementById('runOutput');
  output.value = "";
  try{
    let result=eval(code.replace(/local\s+/g,"var "));
    output.value+="> Success: "+result+"\n";
  } catch(e){
    output.value+="> ERROR: "+e+"\n";
  }
});

async function fetchScripts(page=1,max=20){
  const resp = await fetch(`https://scriptblox.com/api/script/fetch?page=${page}&max=${max}`);
  return await resp.json();
}
document.getElementById('searchBtn').addEventListener('click',async()=>{
  const query = document.getElementById('searchQuery').value.trim().toLowerCase();
  const results = document.getElementById('searchResults');
  results.innerHTML = "Loading...";
  try{
    const data = await fetchScripts();
    results.innerHTML = "";
    if(data.result && data.result.scripts){
      let found=false;
      data.result.scripts.forEach(s=>{
        if(s.title.toLowerCase().includes(query)){
          found=true;
          const div=document.createElement('div');
          div.className="script-result";
          div.innerHTML = `<img src="${s.game.imageUrl || ''}" alt="game image">
            <div class="script-text">
              <strong>${s.title}</strong>
              <span>Game: ${s.game.name}</span>
              <span>Slug: ${s.slug}</span>
              <span>Verified: ${s.verified}</span>
              <span>Key: ${s.key}</span>
            </div>`;
          results.appendChild(div);
        }
      });
      if(!found) results.innerHTML="No scripts found for that query.";
    } else results.innerHTML="No scripts found.";
  } catch(err){
    results.innerHTML="Error fetching scripts: "+err;
  }
});
</script>
</body>
</html>
