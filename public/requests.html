<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Script Requests</title>
<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #111;
    color: #fff;
}
.container {
    max-width: 800px;
    margin: 30px auto;
    padding: 0 16px;
}
.section-title {
    font-size: 28px;
    margin-bottom: 20px;
    border-bottom: 2px solid #444;
    padding-bottom: 6px;
    color: #00eeff;
}
.card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 16px;
}
.card {
    background: #1d1d1d;
    padding: 16px;
    border-radius: 12px;
    box-shadow: 0 0 12px rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.card input, .card input[type=number] {
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #333;
    background: #13161c;
    color: #fff;
    font-size: 14px;
    width: 100%;
}
.card button {
    padding: 10px;
    border-radius: 8px;
    border: none;
    background: #1a5fb4;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s;
}
.card button:hover {
    background: #1a73e8;
}
.inline-msg {
    font-size: 13px;
    margin-top: 5px;
}
.inline-msg.success { color: #55ff55; }
.inline-msg.error { color: #ff5555; }
</style>
</head>
<body>

<div class="container">
    <div class="section-title">Script Requests</div>

    <div class="card-grid">
        <div class="card">
            <input type="text" id="placeId" placeholder="Place ID">
            <input type="text" id="features" placeholder="Features">
            <input type="number" id="amount" placeholder="Willing to pay ($)" min="0">
            <button id="sendRequestBtn">Send Request</button>
            <div id="feedback" class="inline-msg"></div>
        </div>
    </div>
</div>

<script>
const sendRequestBtn = document.getElementById('sendRequestBtn');
const placeInput = document.getElementById('placeId');
const featuresInput = document.getElementById('features');
const amountInput = document.getElementById('amount');
const feedback = document.getElementById('feedback');

let lastSent = 0;
const RateLimit = 5000; // 5 seconds

function showFeedback(msg,type='success'){
    feedback.textContent = msg;
    feedback.className = 'inline-msg ' + (type==='success'?'success':'error');
}

sendRequestBtn.addEventListener('click', async () => {
    const now = Date.now();
    if(now - lastSent < RateLimit){
        showFeedback('Rate limit: wait a few seconds', 'error');
        return;
    }

    const placeId = placeInput.value.trim();
    const features = featuresInput.value.trim();
    const amount = amountInput.value.trim() || '0';

    if(!placeId || !features){
        showFeedback('Fill Place ID & Features', 'error');
        return;
    }

    lastSent = now;

    try {
        // Send to backend instead of direct webhook
        const res = await fetch('/api/request', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({placeId, features, amount})
        });

        if(res.ok){
            showFeedback('Request sent!', 'success');
            placeInput.value = '';
            featuresInput.value = '';
            amountInput.value = '';
        } else {
            showFeedback('Failed to send request', 'error');
        }
    } catch(e){
        showFeedback('Failed to send request', 'error');
    }
});
</script>

</body>
</html>
